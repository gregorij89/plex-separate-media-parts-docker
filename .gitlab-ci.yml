stages:
    - staging
    - production

staging:
    stage: staging
    tags:
        - docker
        - linux
    image: docker:dind
    script:
        - ./build/docker.sh $DOCKER_HUB $DOCKER_USER $DOCKER_PASSWORD $DOCKER_IMAGE_NAME 'dev' $CI_COMMIT_SHORT_SHA
    only:
        - master

publish:
    stage: production
    tags:
        - docker
        - linux
    image: docker:dind
    script:
        - ./build/production.sh $DOCKER_HUB $DOCKER_USER $DOCKER_PASSWORD $DOCKER_IMAGE_NAME $CI_COMMIT_REF_NAME
    only:
     - tags